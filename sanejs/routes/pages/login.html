<script server>
  // POST /admin/login
  server.post('/', async (req, res) => {
    const { checkValidUser } = require('~/dist/data/user.js');
    const { email, password } = req.body;
    const user = await checkValidUser(email, password);
    if (user) {
      req.session.currentUser = user;
      res.redirect('/');
    } else {
      res.render(self, { form: req.body, authFailed: true });
    }
  });
</script>

<div>
  <form novalidate hx-post="/pages/login" hx-select="form">
    <label class="form-group row">
      <div class="col-sm-2 col-form-label">Email</div>
      <div class="col-sm-10">
        <input
          name="email"
          value="{= form.email}"
          class="form-control {? authFailed}is-invalid{/? authFailed}"
          placeholder="Email"
          required
        />
        <div class="invalid-feedback">
          Debe indicar la direcci칩n de correo registrada
        </div>
      </div>
    </label>
    <label class="form-group row">
      <div class="col-sm-2 col-form-label">Contrase침a</div>
      <div class="col-sm-10">
        <input
          type="password"
          name="password"
          value="{= form.password}"
          class="form-control {? authFailed}is-invalid{/? authFailed}"
          placeholder="Contrase침a"
          required
        />
        <div class="invalid-feedback">Debe indicar una contrase침a</div>
      </div>
    </label>
    {? authFailed }
    <span class="text-error">Authentication failed</span>
    {/? authFailed }
    <button type="submit" class="btn btn-primary">Acceder</button>
  </form>
</div>
